# Requires kubeseal cli to be installed: https://github.com/bitnami-labs/sealed-secrets?tab=readme-ov-file#kubeseal
# You might have to adjust the value of --controller-namespace
plugins:
  sealed-secrets-show:
    shortCut: Shift-S
    confirm: false
    description: Create a sealed secret from existing secret and display it
    scopes:
      - secrets
    command: bash
    background: false
    args:
      - -c
      - |
        kubectl get secret --context "$CONTEXT" --kubeconfig "$KUBECONFIG" -n "$NAMESPACE" "$NAME" -o yaml \
        | kubeseal --controller-namespace sealed-secrets -o yaml |& less
  sealed-secrets-write:
    shortCut: Shift-W
    confirm: false
    description: Create a sealed secret from existing secret and write it to a file
    scopes:
      - secrets
    command: bash
    background: false
    args:
      - -c
      - |
        SEALED_SECRET=$(
          kubectl get secret --context "$CONTEXT" --kubeconfig "$KUBECONFIG" -n "$NAMESPACE" "$NAME" -o yaml \
          | kubeseal --controller-namespace sealed-secrets -o yaml
        )
        
        if [ $? -ne 0 ]; then
          read -n 1 -s -r -p "Press any key to exit"
          exit 1
        fi
        
        DEFAULT_FILE="${NAME}-sealed.yaml"
        
        read -rp "Write sealed secret to file [${DEFAULT_FILE}]: " OUT
        OUT="${OUT:-$DEFAULT_FILE}"
        
        printf '%s\n' "$SEALED_SECRET" > "$OUT"
        echo "Wrote: $OUT"
